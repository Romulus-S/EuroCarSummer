<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sold Cars — Euro Car Summer</title>
  <link rel="stylesheet" href="styles.css">
  <script src="layout.js" defer></script>
</head>
<body>
  <header class="site-header"></header>
  <main>
    <div class="container sold-page">
      <section class="sold-hero">
        <h1>Recent Sales</h1>
      </section>

      <article class="sold-car">
        <div class="sold-car__media">
          <div class="sold-gallery" data-gallery>
            <div class="sold-gallery__frame">
              <img src="images/fiat1.jpg" class="is-active" />
              <img src="images/fiat2.jpg" hidden />
              <img src="images/fiat3.jpg" hidden />
              <img src="images/fiat4.jpg" hidden />
              <img src="images/fiat5.jpg" hidden />
              <img src="images/fiat6.jpg" hidden />
              <img src="images/fiat7.jpg" hidden />
              <img src="images/fiat8.jpg" hidden />
              <img src="images/fiat9.jpg" hidden />
            </div>
            <button class="sold-gallery__nav sold-gallery__nav--prev" type="button" data-prev aria-label="Previous image">‹</button>
            <button class="sold-gallery__nav sold-gallery__nav--next" type="button" data-next aria-label="Next image">›</button>
            <div class="sold-gallery__controls">
              <span class="sold-gallery__counter" data-counter>1 / 3</span>
              <button class="sold-gallery__fullscreen" type="button" data-fullscreen>Full screen</button>
            </div>
          </div>
        </div>
        <div class="sold-car__content">
          <h2>1978 Fiat 127 Fissore Sport</h2>
          <p>Un classico intramontabile rifinito in Argento Metallizzato con interni in cuoio chiaro. Questa 356B ha trovato casa presso un collezionista tedesco che cercava una vettura pronta a macinare chilometri durante i weekend sulle Alpi.</p>
          <ul>
            <li>Matching numbers e certificazione Porsche Classic.</li>
            <li>Restauro completo documentato con oltre 200 foto.</li>
            <li>Kit di attrezzi originale e manuali di bordo presenti.</li>
          </ul>
        </div>
      </article>

      <article class="sold-car">
        <div class="sold-car__media">
          <div class="sold-gallery" data-gallery>
            <div class="sold-gallery__frame">
              <img src="images/51guzzi1.JPG" class="is-active" />
              <img src="images/51guzzi2.JPG" hidden />
              <img src="images/51guzzi3.JPG" hidden />
              <img src="images/51guzzi4.JPG" hidden />
              <img src="images/51guzzi5.JPG" hidden />
              <img src="images/51guzzi6.JPG" hidden />
              <img src="images/51guzzi7.JPG" hidden />
              <img src="images/51guzzi8.JPG" hidden />
              <img src="images/51guzzi9.JPG" hidden />
            </div>
            <button class="sold-gallery__nav sold-gallery__nav--prev" type="button" data-prev aria-label="Previous image">‹</button>
            <button class="sold-gallery__nav sold-gallery__nav--next" type="button" data-next aria-label="Next image">›</button>
            <div class="sold-gallery__controls">
              <span class="sold-gallery__counter" data-counter>1 / 4</span>
              <button class="sold-gallery__fullscreen" type="button" data-fullscreen>Full screen</button>
            </div>
          </div>
        </div>
        <div class="sold-car__content">
          <h2>1951 Moto Guzzi Airone Turismo</h2>
          <p>Importata da nuova per il mercato italiano e rimasta con lo stesso proprietario fino alla nostra vendita, questa Merak rappresenta l'essenza delle GT anni '70 con il suo V6 centrale e l'estetica firmata Giugiaro.</p>
          <ul>
            <li>Solo 38.000 km da nuova con storico manutenzione Maserati.</li>
            <li>Colorazione originale Giallo Fly con interni Marrone Testa di Moro.</li>
            <li>Motore e carburatori appena revisionati da specialista di Modena.</li>
          </ul>
        </div>
      </article>

      <article class="sold-car">
        <div class="sold-car__media">
          <div class="sold-gallery" data-gallery>
            <div class="sold-gallery__frame">
              <img src="images/53guzzi1.JPG" class="is-active" />
              <img src="images/53guzzi2.JPG" hidden />
              <img src="images/53guzzi3.JPG" hidden />
              <img src="images/53guzzi4.JPG" hidden />
              <img src="images/53guzzi5.JPG" hidden />
              <img src="images/53guzzi6.JPG" hidden />
              <img src="images/53guzzi7.JPG" hidden />
              <img src="images/53guzzi8.JPG" hidden />
              <img src="images/53guzzi9.JPG" hidden />
            </div>
            <button class="sold-gallery__nav sold-gallery__nav--prev" type="button" data-prev aria-label="Previous image">‹</button>
            <button class="sold-gallery__nav sold-gallery__nav--next" type="button" data-next aria-label="Next image">›</button>
            <div class="sold-gallery__controls">
              <span class="sold-gallery__counter" data-counter>1 / 4</span>
              <button class="sold-gallery__fullscreen" type="button" data-fullscreen>Full screen</button>
            </div>
          </div>
        </div>
        <div class="sold-car__content">
          <h2>1953 Moto Guzzi Airone Sport</h2>
          <p>Una delle rarissime versioni Volumetrico omologate per la strada, venduta a un appassionato di rally storico. La vettura è stata curata maniacalmente con aggiornamenti meccanici discreti ma reversibili.</p>
          <ul>
            <li>Numero di telaio tra i primi 200 esemplari prodotti.</li>
            <li>Compressore Volumex revisionato con garanzia di 12 mesi.</li>
            <li>Assetto Bilstein regolabile e cerchi Cromodora originali.</li>
          </ul>
        </div>
      </article>
    </div>
  </main>
  <footer class="site-footer"></footer>

  <script>
    (function () {
      const lightbox = createLightbox();

      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('[data-gallery]').forEach(setupGallery);
      });

      function setupGallery(gallery) {
        const images = Array.from(gallery.querySelectorAll('img'));
        const counter = gallery.querySelector('[data-counter]');
        const nextButton = gallery.querySelector('[data-next]');
        const prevButton = gallery.querySelector('[data-prev]');
        const fullscreenButton = gallery.querySelector('[data-fullscreen]');

        if (!images.length) return;

        const state = {
          images,
          index: 0,
          goTo(nextIndex) {
            const total = images.length;
            state.index = (nextIndex + total) % total;
            images.forEach((img, idx) => {
              const isActive = idx === state.index;
              img.classList.toggle('is-active', isActive);
              if (isActive) {
                img.removeAttribute('hidden');
                img.setAttribute('aria-hidden', 'false');
              } else {
                img.setAttribute('hidden', 'hidden');
                img.setAttribute('aria-hidden', 'true');
              }
            });
            if (counter) {
              counter.textContent = `${state.index + 1} / ${total}`;
            }
            if (lightbox.isOpen(state)) {
              lightbox.update(state);
            }
          },
          next() {
            state.goTo(state.index + 1);
          },
          prev() {
            state.goTo(state.index - 1);
          }
        };

        if (nextButton) {
          nextButton.addEventListener('click', () => state.next());
        }
        if (prevButton) {
          prevButton.addEventListener('click', () => state.prev());
        }
        images.forEach((img) => {
          img.addEventListener('click', () => lightbox.open(state));
        });
        if (fullscreenButton) {
          fullscreenButton.addEventListener('click', () => lightbox.open(state));
        }

        state.goTo(0);
      }

      function createLightbox() {
        const overlay = document.createElement('div');
        overlay.className = 'lightbox';
        overlay.setAttribute('aria-hidden', 'true');
        overlay.innerHTML = `
          <div class="lightbox__backdrop" data-close></div>
          <div class="lightbox__content" role="dialog" aria-modal="true" aria-label="Full screen image viewer">
            <button class="lightbox__close" type="button" data-close aria-label="Close full screen">×</button>
            <button class="lightbox__nav lightbox__nav--prev" type="button" data-prev aria-label="Previous image">‹</button>
            <figure class="lightbox__figure">
              <img class="lightbox__image" src="" alt="" />
              <figcaption class="lightbox__caption"></figcaption>
              <span class="lightbox__counter" data-counter>0 / 0</span>
            </figure>
            <button class="lightbox__nav lightbox__nav--next" type="button" data-next aria-label="Next image">›</button>
          </div>
        `;
        document.body.appendChild(overlay);

        const closeButton = overlay.querySelector('.lightbox__close');
        const nextButton = overlay.querySelector('[data-next]');
        const prevButton = overlay.querySelector('[data-prev]');
        const imageEl = overlay.querySelector('.lightbox__image');
        const captionEl = overlay.querySelector('.lightbox__caption');
        const counterEl = overlay.querySelector('.lightbox__counter');

        let activeState = null;

        function open(state) {
          if (!state || !state.images.length) return;
          activeState = state;
          overlay.classList.add('is-active');
          overlay.setAttribute('aria-hidden', 'false');
          document.body.classList.add('lightbox-open');
          update(state);
        }

        function close() {
          overlay.classList.remove('is-active');
          overlay.setAttribute('aria-hidden', 'true');
          document.body.classList.remove('lightbox-open');
          activeState = null;
        }

        function update(state = activeState) {
          if (!state) return;
          const currentImage = state.images[state.index];
          if (!currentImage) return;
          imageEl.src = currentImage.src;
          imageEl.alt = currentImage.alt || '';
          captionEl.textContent = currentImage.dataset.caption || currentImage.alt || '';
          counterEl.textContent = `${state.index + 1} / ${state.images.length}`;
        }

        function handleKeydown(event) {
          if (!activeState) return;
          if (event.key === 'Escape') {
            event.preventDefault();
            close();
            return;
          }
          if (event.key === 'ArrowLeft') {
            event.preventDefault();
            activeState.prev();
          } else if (event.key === 'ArrowRight') {
            event.preventDefault();
            activeState.next();
          }
        }

        overlay.addEventListener('click', (event) => {
          if (event.target && 'close' in event.target.dataset) {
            close();
          }
        });

        nextButton.addEventListener('click', () => {
          if (activeState) {
            activeState.next();
          }
        });
        prevButton.addEventListener('click', () => {
          if (activeState) {
            activeState.prev();
          }
        });
        closeButton.addEventListener('click', () => close());
        document.addEventListener('keydown', handleKeydown);

        return {
          open,
          close,
          update,
          isOpen(state) {
            return activeState === state;
          }
        };
      }
    })();
  </script>
</body>
</html>
